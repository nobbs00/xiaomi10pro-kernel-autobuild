name: ç¼–è¯‘KSUNâ€”â€”SUSå†…æ ¸
run-name: ${{ github.actor }} æ­£åœ¨ç¼–è¯‘ éªé¾™865 å°ç±³ç³»åˆ—å†…æ ¸ï¼ğŸš€ ğŸš€

on:
  workflow_dispatch:
    inputs:
      phone:
        description: 'é€‰æ‹©æ‰‹æœºå‹å·ï¼š'
        required: true
        default: 'å°ç±³10pro'
        type: choice
        options:
          - å°ç±³10pro

jobs:
  build_job:
    runs-on: ubuntu-24.04
    steps:
      - name: è®¾ç½®ç¼–è¯‘ç¯å¢ƒ
        run: |
          mkdir -p $GITHUB_WORKSPACE/kernel_workspace
          cd $GITHUB_WORKSPACE/kernel_workspace
          mkdir -p 2025
          cd 2025
          wget https://github.com/kdrag0n/proton-clang/archive/refs/tags/20210522.zip
          unzip 20210522.zip
          
      - name: å…‹éš†å†…æ ¸æºç 
        run: |
          cd $GITHUB_WORKSPACE/kernel_workspace
          git clone -b test https://github.com/nobbs00/kernel_xiaomi_sm8250_mod.git --depth=1 android_kernel
          git clone -b test https://github.com/nobbs00/xiaomi10pro-kernel-autobuild.git src
      - name: 4.é›†æˆKSU
        run: |
          ls
          echo "è¿›å…¥æºç ç›®å½•"
          cd $GITHUB_WORKSPACE/kernel_workspace/android_kernel
          cp $GITHUB_WORKSPACE/kernel_workspace/src/patches/* .
          patch -p1 < new_defconfig.patch
          

      - name: å¼€å§‹ç¼–è¯‘
        run: |
          cd $GITHUB_WORKSPACE/kernel_workspace/android_kernel
          bash build.sh cmi ksu

      - name: ä¸Šä¼ åˆ·å…¥åŒ…
        uses: actions/upload-artifact@v4
        with:
          name: Kernel_MIUI_cmi
          path: kernel_workspace/android_kernel/anykernel/*
          retention-days: 3
